<template>
	<div class="contact-info-wrapper">
		<Heading name="联系人信息">
      <a-button 
      	v-if="pageType == 1"
      	type="primary" 
      	@click="handleSubmit">
        <i :class="['iconfont', 'icon-baocun']"></i>
        保存
      </a-button>
    </Heading>
		<a-card>
			<Descriptions 
				v-if="pageType == 0"
	      :list="labelList" 
	      :param="formData"> 
	    </Descriptions>
			<a-form
				v-else
				:form="form"
	      layout="horizontal"
	      class="es-form"
	      @keydown.native.enter.prevent="handleSubmit">
	      <a-row>
	      	<a-col :md="8" :sm="24">
	      		<a-form-item label="联系人" v-bind="BASE.oneItemLayout">
	            <a-input
	              @click="onSearch('contactName')"
	              v-decorator="[
	                `contactName`,
	                {
	                  validateTrigger: ['blur'],
	                  initialValue: formData.contactName,
	                  rules: [{ required: true, message: '请选择联系人' }]
	                }
	              ]"
	              placeholder="请选择">
	              <a-icon
	                slot="suffix"
	                type="search"
	                @click="onSearch('contactName')"/>
	            </a-input>
	          </a-form-item>
	      	</a-col>
	      	<a-col :md="8" :sm="24">
	      		<a-form-item label="电话" v-bind="BASE.oneItemLayout">
	            <a-input
	              disabled
	              v-model="formData.createUnitName"
	              placeholder="根据联系人自动带出"
	            />
	          </a-form-item>
	      	</a-col>
	      </a-row>	
	    </a-form>
	  </a-card>
		<!-- 弹框选联系人 -->
		<a-modal
			v-if="contactNameVisible"
      v-model="contactNameVisible"
      title="选择联系人"
      width="80%"
      :centered="true"
      :maskClosable="false"
      @ok="handleSelectOk('contactName')">
      <contact-select 
      	ref="contactName">
      </contact-select>
    </a-modal>
	</div>
</template>

<script>
	import { saveContactInfo } from "@/services/response";
	export default {
		name: "contact-info",
		props: {
			//0 详情界面，1 编辑界面
			pageType: {
				type: [String, Number],
				default: 0
			},
			projectData: {
				type: Object,
				default() {
					return {}
				}
			}
		},
		components: {
			Heading: () => import('@/components/heading/Heading'),
			Descriptions: () => import('@/components/descriptions/Description'),
			ContactSelect: () => import("@/components/table/ContactSelect")
		},
		data() {
			return {
				form: this.$form.createForm(this),
				formData: {},
				contactNameVisible: false,
				labelList: [
	        {
	          label: "联系人",
	          key: "contactName",
	          show: true
	        },
	        {
	          label: "电话",
	          key: "contactPhone",
	          show: true
	        }
	      ]
			}
		},
		methods: {
			handleSubmit() {
				this.form.validateFields((err, values) => {
					console.log("values", values);
					if (!err) {
						saveContactInfo(this.formData).then(res => {
		          const resData = res.data || {};
		          if (resData.errCode == "0000") {
		            this.$message.success(resData.responseResult, 3);
		            this.fnGetData();
		          } else {
		            this.$error({
		              title: "错误提示",
		              content: this.BASE.handleErrorMsg(resData)
		            });
		          }
		        });
					}
				})
			},
			onSearch(type) {
				this[`${type}Visible`] = true;
			},
			handleSelectOk(key) {
				let data = this.$refs[key].getRes();
				console.log(data);
				this[`${key}Visible`] = false;
			}
		}
	}
</script>