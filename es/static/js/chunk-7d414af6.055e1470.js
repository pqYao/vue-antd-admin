(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7d414af6"],{2007:function(e,t,a){},4823:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dt-product-info-wrapper"},[a("a-card",[a("Heading",{attrs:{name:"产品明细"}},[1==e.pageType&&0!=e.divideTenderDataLength?a("div",{staticClass:"table-operations"},[a("a-button",{attrs:{type:"primary"},on:{click:e.fnAddProduct}},[e._v(" 关联产品 ")]),a("a-popconfirm",{attrs:{disabled:0==e.deleteTitleType,title:"确定批量删除?"},on:{confirm:function(t){return e.fnDeleteProduct(1)}}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.fnDeleteProduct(2)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),e._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")])],1):e._e()]),a("div",{staticClass:"table-wrapper"},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-table",{staticClass:"es-table",attrs:{bordered:"",size:"small",rowKey:"subtenderDetailId",loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,scroll:{x:1e3},rowSelection:0==e.pageType?null:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange}},scopedSlots:e._u([{key:"amount",fn:function(t,n,i){return[1==e.pageType?a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount"+i,{rules:[{required:!0,validator:e.fnCheckNumber}],validateTrigger:["blur"],initialValue:t}],expression:"[\n                  `amount${index}`,\n                  {\n                    rules: [{ required: true, validator: fnCheckNumber }],\n                    validateTrigger: ['blur'],\n                    initialValue: text\n                  }\n                ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:"",type:"number",placeholder:"请输入需求数量"},on:{focus:function(t){return e.fnFocus(t,n)},change:function(t){return e.fnHandleChange(t.target.value,n.subtenderDetailId,"amount")}}})],1):a("p",[e._v(e._s(t))])]}},{key:"action",fn:function(t){return[a("a-popconfirm",{attrs:{title:"确定删除?"},on:{confirm:function(a){return e.fnDeleteProduct(0,t.subtenderDetailId)}}},[a("a",[e._v("删除")])])]}}])})],1)],1),0==e.pageType?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}}):e._e()],1),e.productVisible?a("a-modal",{attrs:{title:"选择产品",width:"80%",centered:!0,maskClosable:!1},on:{ok:function(t){return e.handleSeleProductOk("product")}},model:{value:e.productVisible,callback:function(t){e.productVisible=t},expression:"productVisible"}},[a("ProductSelect",{ref:"productSele",attrs:{param:e.seleProParam}})],1):e._e()],1)},i=[],r=(a("4de4"),a("4160"),a("a15b"),a("a434"),a("a9e3"),a("d3b7"),a("159b"),a("2909")),o=a("5530"),s=a("5880"),c=a("35a4"),l={name:"dt-product-info",components:{Heading:function(){return a.e("chunk-e2119ce0").then(a.bind(null,"8ab7"))},pagination:function(){return a.e("chunk-03edaf33").then(a.bind(null,"325f"))},ProductSelect:function(){return Promise.all([a.e("chunk-6977438e"),a.e("chunk-2d0a3328")]).then(a.bind(null,"00c5"))}},props:{pageType:{type:[Number,String],default:1},projectData:{type:Object,default:function(){return{}}},divideTenderDataLength:{type:[String,Number],default:0},isUpdateProjectInfo:{type:Boolean,default:!1}},data:function(){return{form:this.$form.createForm(this),productVisible:!1,seleProParam:{},leftAmount:0,curRecord:{},selectedRowKeys:[],selectedRows:[],targetpage:void 0,filter:{},pageData:{limit:15,total:0,page:1,loading:!1},selectedProd:[],dataSource:[],columns:[],columnsData:[{title:"序号",dataIndex:"number",align:"center",customRender:function(e,t,a){return"".concat(a+1)},width:60},{title:"标名",dataIndex:"subTenderName",align:"center",ellipsis:!0},{title:"产品编码",dataIndex:"productCode",width:150,align:"center"},{title:"产品名称",dataIndex:"productName",ellipsis:!0,width:250},{title:"单位",dataIndex:"measure",align:"center"},{title:"总数量",dataIndex:"totalAmount",align:"center"},{title:"需求数量",dataIndex:"amount",align:"center",scopedSlots:{customRender:"amount"}},{title:"操作",align:"center",width:60,scopedSlots:{customRender:"action"}}]}},computed:Object(o["a"])(Object(o["a"])({},Object(s["mapGetters"])("account",["dictionary"])),{},{deleteTitleType:function(){return 0==this.selectedRowKeys.length?0:1}}),created:function(){this.fnInit()},watch:{projectData:function(){this.fnInit()},isUpdateProjectInfo:function(e){e&&this.fnGetData()}},methods:{fnInit:function(){this.columns=[];var e=Object(r["a"])(this.columnsData),t=this.columnsData.length-1;0==this.pageType&&e.splice(t,1),this.columns=Object(r["a"])(e),this.projectData.projectId&&this.fnGetData()},fnGetData:function(){var e=this,t=Object.assign({limit:0==this.pageType?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectData.projectId});this.pageData.loading=!0,Object(c["db"])(t).then((function(t){var a=t.data||{},n=a.responseResult||{};if("0000"==a.errCode){var i=n.data,r=n.total;e.dataSource=i,e.selectedProd=[],0!=e.dataSource.length&&e.dataSource.forEach((function(t){e.selectedProd.push(t.projectDetailId)})),e.pageData.total=Number(r),e.$emit("finish-get-product-info")}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},fnAddProduct:function(){this.productVisible=!0,this.seleProParam={subtenderId:this.$route.params.id,projectId:this.projectData.projectId,selectedProd:this.selectedProd}},handleSeleProductOk:function(){var e=this,t=this.$refs.productSele.getRes();if(t.subtenderId)if(0!=t.selectedRowKeys.length){var a={projectId:this.projectData.projectId,subIds:t.selectedRowKeys.join(",")};Object(c["c"])(a).then((function(t){var a=t.data;"0000"===a.errCode?e.fnGetData():e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})})),this.productVisible=!1}else this.$message.warning("请先选择产品。");else this.$message.warning("请先选择标, 再选择对应的产品。")},fnDeleteProduct:function(e,t){var a=this;if(2!=e||0!=this.deleteTitleType){if(2!=e){var n=1==e?this.selectedRowKeys.join(","):t;Object(c["q"])(n).then((function(e){var t=e.data||{};"0000"==t.errCode?(a.$message.success(t.responseResult||"删除成功",3),a.fnClearCheckdData(),a.fnGetData()):a.$error({title:"错误提示",content:a.BASE.handleErrorMsg(t)})}))}}else this.$message.warning("请选择要删除的数据！")},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(e){e||Object(c["wb"])(t.dataSource).then((function(e){var a=e.data||{};"0000"==a.errCode?(t.$message.success(a.responseResult,3),t.fnGetData()):t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))}))},fnHandleChange:function(e,t,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(e){return t===e.subtenderDetailId}))[0];if(i){var o=i.totalAmount,s=0;this.dataSource.forEach((function(e){i.productId==e.productId&&e.subtenderDetailId!=i.subtenderDetailId&&(s+=Number(e.amount))})),this.leftAmount=o-s,i[a]=e,this.dataSource=n}},fnFocus:function(e,t){this.curRecord=t},fnCheckNumber:function(e,t,a){if(this.BASE.CheckIsNullOrEmpty(t)){var n=this.BASE.reg.mountReg;n.test(t)?"{}"!=JSON.stringify(this.curRecord)&&t>this.leftAmount?a("超过总数量限制"):(this.curRecord={},a()):a("请输入0.01-999999999999.99的数值！")}else a("请输入需求数量")},fnClearCheckdData:function(){this.selectedRowKeys=[],this.selectedRows=[]},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.fnGetData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.fnGetData()}}},d=l,u=(a("919e"),a("2877")),p=Object(u["a"])(d,n,i,!1,null,"033dd6f1",null);t["default"]=p.exports},"919e":function(e,t,a){"use strict";var n=a("2007"),i=a.n(n);i.a}}]);