(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c775bca","chunk-2d0aeadc","chunk-1ba20d2e","chunk-2d0d0642"],{"029e":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("project-info",{attrs:{id:"项目信息",url:"/other/prepare/detail",purchaseTypeKey:"otherPurchaseType",projectData:e.formData}})],1)},i=[],r=a("0aa6"),o=a("5cb8"),s={name:"sub-contract-project",components:{ProjectInfo:r["default"]},data:function(){return{formData:{}}},created:function(){this.findInfo()},methods:{findInfo:function(){var e=this;Object(o["F"])(this.$route.params.id).then((function(t){var a=t.data;if("0000"==a.errCode){var n=a.responseResult;e.formData=n}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))}}},c=s,l=a("2877"),u=Object(l["a"])(c,n,i,!1,null,null,null);t["a"]=u.exports},"0aa6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"project-info-des-wrapper"},[a("a-card",[a("Heading",{attrs:{name:"项目信息"}}),a("Descriptions",{attrs:{list:e.labelList,param:e.projectData,jumpData:e.jumpData}})],1)],1)},i=[],r=(a("99af"),a("d3b7"),{name:"project-info-des",props:{projectData:{type:Object,default:function(){return{}}},url:{type:String,default:""},purchaseTypeKey:{type:String,default:"purchaseType"}},components:{Heading:function(){return a.e("chunk-e2119ce0").then(a.bind(null,"8ab7"))},Descriptions:function(){return a.e("chunk-645cdc36").then(a.bind(null,"57e4"))}},data:function(){return{jumpData:{},labelList:[{label:"项目编号",key:"projectCode",show:!0,jump:!0},{label:"项目名称",key:"projectName",show:!0},{label:"采购方式",key:"purchaseType",show:!0,pt:!0},{label:"是否委托",key:"entrustFlag",flag:!0,show:!0},{label:"是否资格预审",key:"prequalficationFlag",flag:!0,show:!0}]}},created:function(){this.fnInit()},watch:{projectData:function(){this.fnInit()},purchaseTypeKey:function(){this.fnInit()}},methods:{fnInit:function(){this.jumpData={projectCode:{url:"".concat(this.url,"/").concat(this.projectData.projectId)}},this.labelList[2].key=this.purchaseTypeKey}}}),o=r,s=a("2877"),c=Object(s["a"])(o,n,i,!1,null,null,null);t["default"]=c.exports},"3eb5":function(e,t,a){"use strict";var n=a("adf3"),i=a.n(n);i.a},4321:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",[a("Heading",{attrs:{name:"分包明细"}},[e.isDetail?e._e():[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleAdd("product")}}},[e._v(" 分包 ")]),a("pop-confirm-btn",{attrs:{title:"是否快捷分包?",hoverContent:"在每个标下分1个包，并自动关联每个标下的所有产品",btnName:"快捷分包"},on:{"confirm-action":e.addFast}}),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:e.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),e._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary",disabled:e.isConnect},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")])]],2),a("a-table",{staticClass:"es-table",attrs:{size:"small",bordered:!0,loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,rowKey:"subcontractingId",rowSelection:e.isDetail?null:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},scroll:{x:!0}},scopedSlots:e._u([{key:"subcontractingName",fn:function(t,n,i){return[e.isDetail?a("span",[e._v(e._s(t))]):a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["subcontractingName"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:e.checkSubContract}],initialValue:t}],expression:"[\n                `subcontractingName${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: checkSubContract }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{focus:function(t){return e.fnFocus(t,n)},change:function(t){return e.onCellChange(t.target.value,n.subcontractingId,"subcontractingName")}}})],1)],1)]}},{key:"bondMoney",fn:function(t,n,i){return[e.isDetail?a("span",[e._v(e._s(t))]):a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["bondMoney"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:e.validMoney}],initialValue:t}],expression:"[\n                `bondMoney${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: validMoney }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{disabled:!n.subcontractingName,allowClear:""},on:{change:function(t){return e.onCellChange(t.target.value,n.subcontractingId,"bondMoney")}}})],1)],1)]}},{key:"reckonMoney",fn:function(t,n,i){return[e.isDetail?a("span",[e._v(e._s(t))]):a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["reckonMoney"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:e.validMoney}],initialValue:t}],expression:"[\n                `reckonMoney${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: validMoney }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{change:function(t){return e.onCellChange(t.target.value,n.subcontractingId,"reckonMoney")}}})],1)],1)]}},{key:"action",fn:function(t){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return e.deleteById(t.subcontractingId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[e._v("删除")])])]}}])}),this.isDetail?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}}):e._e()],1),e.productVisible?a("a-modal",{attrs:{title:"分包",width:"80%",centered:!0,maskClosable:!1},on:{ok:function(t){return e.handleOk("product")}},model:{value:e.productVisible,callback:function(t){e.productVisible=t},expression:"productVisible"}},[a("ProductSelect",{ref:"product",attrs:{projectId:this.projectId},on:{getData:e.getData}})],1):e._e()],1)},i=[],r=(a("4de4"),a("4160"),a("a15b"),a("a9e3"),a("159b"),a("2909")),o=a("8ab7"),s=a("687a"),c=a("5cb8"),l=a("325f"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-row",{attrs:{type:"flex"}},[a("a-col",{attrs:{flex:1}},[a("a-card",[a("Heading",{attrs:{name:"层级"}}),e.treeData.length>0?a("a-tree",{attrs:{"show-line":"","tree-data":this.treeData,defaultExpandAll:e.autoExpandParent,defaultSelectedKeys:e.selectedKeys},on:{select:e.onSelect}}):e._e()],1)],1),a("a-col",{attrs:{flex:4}},[a("div",[a("a-card",[a("Heading",{attrs:{name:"查询结果"}},[a("a-button",{attrs:{type:"primary",disabled:e.isConnect},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")]),a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleAdd()}}},[a("i",{class:["iconfont","icon-xinzeng"]}),e._v(" 新增 ")]),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:e.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),e._v(" 批量删除 ")])],1)],1),a("a-table",{staticClass:"es-table",attrs:{size:"small",loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,rowSelection:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},scroll:{x:!0},rowKey:"subcontractingId"},scopedSlots:e._u([{key:"subcontractingName",fn:function(t,n,i){return[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["subcontractingName"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:e.checkSubContract}],initialValue:t}],expression:"[\n                    `subcontractingName${index}`,\n                    {\n                      validateTrigger: ['blur'],\n                      rules: [\n                        { required: true, validator: checkSubContract }\n                      ],\n                      initialValue: text\n                    }\n                  ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{focus:function(t){return e.fnFocus(t,n)},change:function(t){return e.onCellChange(t.target.value,n.subcontractingId,"subcontractingName")}}})],1)],1)]}},{key:"action",fn:function(t){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return e.deleteById(t.subcontractingId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[e._v("删除")])])]}}])}),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}})],1)],1)])],1)},d=[],h=a("5530"),g=a("5880"),p={limit:15,total:0,page:1,loading:!1},f=[{title:"序号",dataIndex:"number",align:"center",customRender:function(e,t,a){return"".concat((p.page-1)*p.limit+a+1)},width:100},{title:"包名",dataIndex:"subcontractingName",scopedSlots:{customRender:"subcontractingName"}},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],m=[],b={name:"sub-contract-select",components:{Pagination:l["default"],Heading:o["default"]},props:{projectId:{type:String,default:""}},data:function(){return{form:this.$form.createForm(this),treeData:[],selectedKeys:[],columns:f,dataSource:m,selectedRowKeys:[],selectedRows:[],autoExpandParent:!0,isConnect:!1,curRecord:{},pageData:{limit:15,total:0,page:1,loading:!1}}},computed:Object(h["a"])({hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}},Object(g["mapGetters"])("account",["dictionary"])),watch:{treeData:{handler:function(e){return e},immediate:!0,deep:!0}},created:function(){this.init()},methods:{init:function(){this.getData(),this.findTree()},findTree:function(){var e=this;Object(c["k"])(this.projectId).then((function(t){var a=t.data;if("0000"==a.errCode){var n=a.responseResult;e.treeData.push(n),e.treeData.forEach((function(t){if(t.children.length>0){if(!t.selectable)return void t.children.forEach((function(t){e.recursive(t)}));e.selectedKeys=["".concat(t.key)],e.getData()}}))}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},recursive:function(e){var t=this;if(e.selectable)this.selectedKeys.length>0||(this.selectedKeys=["".concat(e.key)],this.getData());else{if(null==e.children)return;e.children.forEach((function(e){t.recursive(e)}))}},onSelect:function(e){this.selectedKeys=e,this.pageData.page=1,this.getData()},getData:function(){var e=this,t=Object.assign({limit:this.pageData.limit,page:this.pageData.page,subtenderId:this.selectedKeys[0]||"",projectId:this.projectId||""});this.pageData.loading=!0,this.dataSource=[],Object(c["C"])(t).then((function(t){var a=t.data,n=t.data.responseResult;if("0000"==a.errCode){var i=n.data,o=n.total;e.dataSource=Object(r["a"])(i),e.pageData.total=Number(o),e.$emit("getData")}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},fnFocus:function(e,t){this.curRecord=t},checkSubContract:function(e,t,a){var n=this;if(this.BASE.CheckIsNullOrEmpty(t)){var i="";this.BASE.ObjectIsNull(this.curRecord)?a():(this.dataSource.forEach((function(e){n.curRecord.subcontractingId&&n.curRecord.subcontractingId==e.subcontractingId&&(i=e.subcontractingId)})),Object(c["gb"])(this.projectId,this.selectedKeys[0],i,t).then((function(e){var t=e.data,n="";"0000"!==t.errCode?(n=t.customMess,a(n)):a()})),this.curRecord={})}else a("请输入包名")},onCellChange:function(e,t,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(e){return t===e.subcontractingId}))[0];i&&(i[a]=e,this.dataSource=n)},handleAdd:function(){var e=this;this.selectedKeys?Object(c["f"])(this.projectId,this.selectedKeys.join(",")).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.success(n,3),e.getData()}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})})):this.$message.warning("请先在左侧选中标！")},handleDelete:function(e){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=e&&this.deleteById()},deleteById:function(e){var t=this,a=e||this.selectedRowKeys.join(",");Object(c["o"])(a).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.warning(n),t.selectedRowKeys=[],t.getData()}}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},getRes:function(){return this.selectedRowKeys},handleSubmit:function(e){var t=this;e.preventDefault(e),this.form.validateFields((function(e){e||(t.isConnect=!0,t.updateInfo())}))},updateInfo:function(){var e=this;Object(c["ab"])(this.dataSource).then((function(t){var a=t.data;"0000"===a.errCode?(e.$message.success(a.responseResult,3),e.getData()):e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)}),e.isConnect=!1}))}}},v=b,y=a("2877"),D=Object(y["a"])(v,u,d,!1,null,null,null),S=D.exports,w={limit:15,total:0,page:1,loading:!1},C=[{title:"序号",dataIndex:"number",align:"center",width:80,customRender:function(e,t,a){return"".concat((w.page-1)*w.limit+a+1)}},{title:"标名",dataIndex:"subTenderName",align:"center"},{title:"包名",dataIndex:"subcontractingName",scopedSlots:{customRender:"subcontractingName"},align:"center"},{title:"估算含税金额（元)",dataIndex:"reckonMoney",scopedSlots:{customRender:"reckonMoney"},align:"center"},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],x=[],I={name:"sub-contract-table",components:{Heading:o["default"],Pagination:l["default"],ProductSelect:S,PopConfirmBtn:s["default"]},props:{isDetail:{type:Boolean,default:!1}},data:function(){return{form:this.$form.createForm(this),columns:C,dataSource:x,projectId:this.$route.params.id,selectedRowKeys:[],selectedRows:[],curRecord:{},isConnect:!1,productVisible:!1,pageData:w}},watch:{isDetail:{handler:function(e){if(e){var t=Object(r["a"])(this.columns);delete t[4],this.columns=t}return e},immediate:!0,deep:!0}},computed:{hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}},mounted:function(){this.getData()},methods:{getData:function(){var e=this,t=Object.assign({limit:this.isDetail?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectId},this.filter);this.dataSource=[],this.pageData.loading=!0,Object(c["C"])(t).then((function(t){var a=t.data,n=t.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;e.dataSource=i,e.$emit("emit-sc-length",e.dataSource.length),e.$emit("update-product-info"),e.pageData.total=Number(r)}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},handleAdd:function(e){this["".concat(e,"Visible")]=!0},handleOk:function(e){this.getData(),this["".concat(e,"Visible")]=!1},addFast:function(){var e=this;Object(c["e"])(this.projectId).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.success(n,3),e.getData()}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},validMoney:function(e,t,a){var n=this.BASE.reg.moneyReg;this.BASE.CheckIsNullOrEmpty(t)?(n.test(t)||a("请输入正确的金额"),a()):a("请输入金额")},fnFocus:function(e,t){this.curRecord=t},checkSubContract:function(e,t,a){var n=this;if(this.BASE.CheckIsNullOrEmpty(t))if(this.BASE.ObjectIsNull(this.curRecord))a();else{var i="",r="";this.dataSource.forEach((function(e){n.curRecord.subcontractingId&&n.curRecord.subcontractingId==e.subcontractingId&&(r=e.subtenderId,i=e.subcontractingId)})),Object(c["gb"])(this.projectId,r,i,t).then((function(e){var t=e.data,n="";"0000"!==t.errCode?(n=t.customMess,a(n)):a()})),this.curRecord={}}else a("请输入包名")},onCellChange:function(e,t,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(e){return t===e.subcontractingId}))[0];i&&(i[a]=e,this.dataSource=n)},handleSubmit:function(e){var t=this;e.preventDefault(e),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(e){e||(t.isConnect=!0,t.updateInfo())}))},updateInfo:function(){var e=this;Object(c["ab"])(this.dataSource).then((function(t){var a=t.data;"0000"===a.errCode?(e.$message.success(a.responseResult,3),e.getData()):e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)}),e.isConnect=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},handleDelete:function(e){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=e&&this.deleteById()},deleteById:function(e){var t=this,a=e||this.selectedRowKeys.join(",");Object(c["o"])(a).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.success(n),t.selectedRowKeys=[],t.getData()}}))},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()}}},j=I,R=Object(y["a"])(j,n,i,!1,null,null,null);t["a"]=R.exports},5913:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"wrapper",staticClass:"anchor-demo-custom",on:{mouseover:e.mouseOver,mouseleave:e.mouseLeave}},[e.isShow?a("div",{staticClass:"anchor-btn"},[a("a-icon",{attrs:{type:"right"}}),a("a-icon",{staticStyle:{"margin-left":"-4px"},attrs:{type:"right"}})],1):a("div",{staticClass:"anchor-btn"},[a("a-icon",{attrs:{type:"left"}}),a("a-icon",{staticStyle:{"margin-left":"-4px"},attrs:{type:"left"}})],1),a("a-anchor",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],ref:"demo",attrs:{targetOffset:200},on:{click:e.handleClickFun,change:e.onChange}},[e._l(e.anchorList,(function(t,n){return a("span",{key:n},[a("a-anchor-link",{ref:"span",refInFor:!0,attrs:{href:"#"+t}},[a("template",{slot:"title"},[a("i",{class:["iconfont","icon-yuanxing"]}),e._v(" "+e._s(t)+" ")])],2)],1)})),a("div")],2)],1)},i=[],r={props:{anchorList:{type:Array,required:!1}},data:function(){return{isShow:!1}},methods:{handleClickFun:function(e,t){if(e.preventDefault(),t.href){var a=document.getElementById(t.href);a&&a.scrollIntoView({block:"start",behavior:"smooth"})}},mouseOver:function(){var e=this;this.$refs.wrapper.style.marginTop=-(33*this.anchorList.length+40)/2+"px",this.$nextTick((function(){e.isShow=!0}))},mouseLeave:function(){this.isShow=!1},onChange:function(){}}},o=r,s=(a("3eb5"),a("2877")),c=Object(s["a"])(o,n,i,!1,null,"22bac0c2",null);t["default"]=c.exports},6183:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-card",[a("Heading",{attrs:{name:"产品明细"}},[this.isDetail||0==e.subcontractDataLength?e._e():[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleAdd("product")}}},[e._v(" 关联产品 ")]),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:e.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),e._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary",disabled:e.isConnect},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")])]],2),a("a-table",{staticClass:"es-table",attrs:{size:"small",bordered:!0,loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,rowKey:"scontractingDetailId",rowSelection:e.isDetail?null:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},scroll:{x:!0}},scopedSlots:e._u([{key:"amount",fn:function(t,n,i){return[e.isDetail?a("span",[e._v(e._s(t))]):a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:e.checkAmount}],initialValue:t}],expression:"[\n                `amount${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: checkAmount }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{change:function(t){return e.onCellChange(t.target.value,n.scontractingDetailId,"amount")}}})],1)],1)]}},{key:"action",fn:function(t){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return e.deleteById(t.scontractingDetailId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[e._v("删除")])])]}}])}),this.isDetail?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}}):e._e()],1),e.productVisible?a("a-modal",{attrs:{title:"选择产品",width:"80%",centered:!0,maskClosable:!1},on:{ok:function(t){return e.handleOk("product")}},model:{value:e.productVisible,callback:function(t){e.productVisible=t},expression:"productVisible"}},[a("ProductSelect",{ref:"product"})],1):e._e()],1)},i=[],r=(a("4de4"),a("a15b"),a("a9e3"),a("2909")),o=a("8ab7"),s=a("5cb8"),c=a("325f"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-row",{attrs:{type:"flex"}},[a("a-col",{attrs:{flex:1}},[a("a-card",[a("Heading",{attrs:{name:"层级"}}),e.treeData.length>0?a("a-tree",{attrs:{"show-line":"","tree-data":this.treeData,defaultExpandedKeys:e.defaultExpandedKeys,defaultSelectedKeys:e.selectedKeys},on:{select:e.onSelect}}):e._e()],1)],1),a("a-col",{attrs:{flex:4}},[a("div",[a("SearchForm",{ref:"SearchForm",attrs:{searchList:e.searchList,name:"查询条件"},on:{"on-filter":e.toSearch}}),a("a-card",[a("a-table",{attrs:{size:"small",loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,rowSelection:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},scroll:{x:!0},rowKey:"businessKey"},scopedSlots:e._u([{key:"projectCode",fn:function(t){return a("a",{},[e._v(e._s(t))])}}])}),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}})],1)],1)])],1)},u=[],d=(a("4160"),a("159b"),a("5530")),h=a("5880"),g=a("5acc"),p={limit:15,total:0,page:1,loading:!1},f=[{title:"序号",dataIndex:"number",align:"center",customRender:function(e,t,a){return"".concat((p.page-1)*p.limit+a+1)},width:100},{title:"产品编码",dataIndex:"productCode"},{title:"产品名称",dataIndex:"productName"},{title:"产品单位",dataIndex:"measure"},{title:"总数量",dataIndex:"totalAmount"}],m=[],b=[{type:"input",label:"产品名称",key:"productName"},{type:"input",label:"产品编码",key:"productCode"}],v={name:"sub-contract-product-select",components:{SearchForm:g["a"],Pagination:c["default"],Heading:o["default"]},data:function(){return{treeData:[],selectedKeys:[],columns:f,dataSource:m,defaultExpandedKeys:[],searchList:b,selectedRowKeys:[],selectedRows:[],filter:{},pageData:{limit:15,total:0,page:1,loading:!1},projectId:this.$route.params.id}},computed:Object(d["a"])({},Object(h["mapGetters"])("account",["dictionary"])),watch:{treeData:{handler:function(e){return e},immediate:!0,deep:!0}},created:function(){this.init()},methods:{init:function(){this.getData(),this.findTree(),this.findIds()},toSearch:function(e){this.pageData.page=1,this.filter=e,this.getData()},findTree:function(){var e=this;Object(s["j"])({projectId:this.projectId}).then((function(t){var a=t.data;if("0000"==a.errCode){var n=a.responseResult;e.treeData.push(n),e.treeData.forEach((function(t){t.children.length>0&&!t.selectable&&t.children.forEach((function(t){e.recursive(t)}))}))}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},recursive:function(e){var t=this;e.selectable?this.defaultExpandedKeys.length>0||(this.defaultExpandedKeys=["".concat(e.key)],this.selectedKeys=["".concat(e.key)],this.getData()):e.children.forEach((function(e){t.recursive(e)}))},findIds:function(){var e=this;Object(s["h"])(this.projectId).then((function(t){var a=t.data;if("0000"==a.errCode){var n=a.responseResult;e.selectedRowKeys=n}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},onSelect:function(e){this.$refs.SearchForm.handleReset(),this.filter={},this.selectedKeys=e,this.pageData.page=1,this.getData()},getData:function(){var e=this,t=Object.assign({limit:this.pageData.limit,page:this.pageData.page,subcontractingId:this.selectedKeys[0]||"",projectId:this.projectId},this.filter);this.pageData.loading=!0,Object(s["i"])(t).then((function(t){var a=t.data,n=t.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;e.dataSource=i,e.pageData.total=Number(r)}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},getRes:function(){return this.selectedRowKeys}}},y=v,D=a("2877"),S=Object(D["a"])(y,l,u,!1,null,null,null),w=S.exports,C={limit:15,total:0,page:1,loading:!1},x=[{title:"序号",dataIndex:"number",align:"center",width:80,customRender:function(e,t,a){return"".concat((C.page-1)*C.limit+a+1)}},{title:"标名",dataIndex:"subtenderName",align:"center"},{title:"包名",dataIndex:"subcontractingName",align:"center"},{title:"产品编码",dataIndex:"productCode",align:"center"},{title:"产品名称",dataIndex:"productName",align:"center"},{title:"单位",dataIndex:"measure",align:"center"},{title:"总数量",dataIndex:"totalAmount",align:"center"},{title:"需求数量",dataIndex:"amount",scopedSlots:{customRender:"amount"},align:"center"},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],I=[],j={name:"sub-contract-product",components:{Heading:o["default"],Pagination:c["default"],ProductSelect:w},props:{isDetail:{type:Boolean,default:!1},subcontractDataLength:{type:Number}},data:function(){return{form:this.$form.createForm(this),columns:x,dataSource:I,selectedRowKeys:[],selectedRows:[],projectId:this.$route.params.id,isConnect:!1,productVisible:!1,pageData:C}},watch:{isDetail:{handler:function(e){if(e){var t=Object(r["a"])(this.columns);delete t[8],this.columns=t}return e},immediate:!0,deep:!0}},computed:{hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}},created:function(){this.getData()},methods:{getData:function(){var e=this,t=Object.assign({limit:this.isDetail?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectId},this.filter);this.dataSource=[],this.pageData.loading=!0,Object(s["D"])(t).then((function(t){var a=t.data,n=t.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;e.dataSource=i,e.pageData.total=Number(r)}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},handleAdd:function(e){this["".concat(e,"Visible")]=!0},handleOk:function(e){var t=this,a=this.$refs[e].getRes();Object(s["O"])(this.projectId,a.join(",")).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.success(n,3),t.getData()}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})})),this["".concat(e,"Visible")]=!1},checkAmount:function(e,t,a){if(this.BASE.CheckIsNullOrEmpty(t)){var n=this.BASE.reg.mountReg;n.test(t)||a("请输入0.01-999999999999.99的数值！"),a()}else a("请输入需求数量")},onCellChange:function(e,t,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(e){return t===e.scontractingDetailId}))[0];i&&(i[a]=e,this.dataSource=n)},handleSubmit:function(e){var t=this;e.preventDefault(e),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(e){e||(t.isConnect=!0,t.updateInfo())}))},updateInfo:function(){var e=this;Object(s["bb"])(this.dataSource).then((function(t){var a=t.data;"0000"===a.errCode?(e.$message.success(a.responseResult,3),e.getData()):e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)}),e.isConnect=!1}))},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},handleDelete:function(e){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=e&&this.deleteById()},deleteById:function(e){var t=this,a=e||this.selectedRowKeys.join(",");Object(s["p"])(a).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.warning(n),t.selectedRowKeys=[],t.getData()}}))},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.getData()}}},R=j,k=Object(D["a"])(R,n,i,!1,null,null,null);t["a"]=k.exports},"687a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block",marginLeft:"8px"}},[a("a-popconfirm",{attrs:{title:e.title},on:{confirm:e.fnConfirm}},[a("a-popover",{attrs:{placement:"bottom",content:e.hoverContent},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-button",{attrs:{type:"primary"},on:{click:e.fnClick}},[e._v(" "+e._s(e.btnName)+" ")])],1)],1)],1)},i=[],r={name:"pop-confirm-btn",props:{title:{type:String,default:""},hoverContent:{type:String,default:""},btnName:{type:String,default:""}},data:function(){return{visible:!1}},methods:{fnConfirm:function(){this.$emit("confirm-action")},fnClick:function(){this.visible=!1}}},o=r,s=a("2877"),c=Object(s["a"])(o,n,i,!1,null,null,null);t["default"]=c.exports},adf3:function(e,t,a){}}]);