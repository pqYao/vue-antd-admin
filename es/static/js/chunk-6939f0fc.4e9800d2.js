(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6939f0fc"],{"5efc":function(e,t,a){},"66b4":function(e,t,a){"use strict";var n=a("5efc"),r=a.n(n);r.a},"7b84":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"divide-tender-info-wrapper"},[a("a-card",[a("Heading",{attrs:{name:"分标明细"}},[1==e.pageType?a("div",{staticClass:"table-operations"},[a("a-button",{attrs:{type:"primary"},on:{click:e.fnHandleAdd}},[a("i",{class:["iconfont","icon-xinzeng"]}),e._v(" 新增 ")]),a("pop-confirm-btn",{attrs:{title:"确定快捷分标?",hoverContent:"将项目分成1个标，并自动关联项目下所有产品",btnName:"快捷分标"},on:{"confirm-action":e.fnFastSubtender}}),a("a-popconfirm",{attrs:{disabled:0==e.deleteTitleType,title:"确定批量删除?"},on:{confirm:function(t){return e.fnDeleteDivideTender(1)}}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.fnDeleteDivideTender(2)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),e._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")])],1):e._e()]),a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-table",{staticClass:"es-table",attrs:{bordered:"",size:"small",rowKey:"subtenderId",loading:e.pageData.loading,pagination:!1,columns:e.columns,dataSource:e.dataSource,scroll:{x:!0},rowSelection:0==e.pageType?null:{fixed:!0,selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange}},scopedSlots:e._u([{key:"subtenderName",fn:function(t,n,r){return[1==e.pageType?a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["subtenderName"+r,{rules:[{required:!0,validator:e.fnCheckName}],validateTrigger:["blur"],initialValue:t}],expression:"[\n                `subtenderName${index}`,\n                {\n                  rules: [{ required: true, validator: fnCheckName }],\n                  validateTrigger: ['blur'],\n                  // validateFirst: true,\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:"",placeholder:"请输入标名"},on:{focus:function(t){return e.fnFocus(t,n)},change:function(t){return e.fnHandleChange(t.target.value,n.subtenderId,"subtenderName")}}})],1):a("p",[e._v(e._s(t))])]}},{key:"action",fn:function(t,n){return 1==e.pageType?[a("a-popconfirm",{attrs:{title:"确定删除?"},on:{confirm:function(t){return e.fnDeleteDivideTender(0,n.subtenderId)}}},[a("a",[e._v("删除")])])]:void 0}}],null,!0)})],1),0==e.pageType?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:e.pageData.page,pageSize:e.pageData.limit,total:e.pageData.total},on:{change:e.sizeChange,showSizeChange:e.pageChange}}):e._e()],1)],1)},r=[],i=(a("a623"),a("4de4"),a("a15b"),a("a434"),a("a9e3"),a("d3b7"),a("2909")),o=a("5530"),c=a("5880"),s=a("35a4"),d={name:"divide-tender-info",components:{Heading:function(){return a.e("chunk-e2119ce0").then(a.bind(null,"8ab7"))},pagination:function(){return a.e("chunk-03edaf33").then(a.bind(null,"325f"))},PopConfirmBtn:function(){return a.e("chunk-2d0d0642").then(a.bind(null,"687a"))}},props:{pageType:{type:[Number,String],default:1},projectData:{type:Object,default:function(){return{}}}},data:function(){return{form:this.$form.createForm(this),selectedRowKeys:[],selectedRows:[],pageData:{limit:15,total:0,page:1,loading:!1},curRecord:{},dataSource:[],columns:[],columnsData:[{title:"序号",dataIndex:"number",align:"center",customRender:function(e,t,a){return"".concat(a+1)},width:60},{title:"标名",dataIndex:"subtenderName",align:"center",scopedSlots:{customRender:"subtenderName"}},{title:"操作",align:"center",scopedSlots:{customRender:"action"},width:60}]}},computed:Object(o["a"])(Object(o["a"])({},Object(c["mapGetters"])("account",["dictionary"])),{},{fastTitleType:function(){return 0==this.selectedRowKeys.length?0:1},deleteTitleType:function(){return 0==this.selectedRowKeys.length?0:1}}),created:function(){this.fnInit()},watch:{projectData:function(){this.fnInit()}},methods:{fnInit:function(){this.columns=[];var e=Object(i["a"])(this.columnsData),t=this.columnsData.length-1;0==this.pageType&&e.splice(t,1),this.columns=Object(i["a"])(e),this.projectData.projectId&&this.fnGetData()},fnGetData:function(){var e=this,t={limit:0==this.pageType?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectData.projectId};Object(s["ab"])(t).then((function(t){var a=t.data||{},n=a.responseResult||{};if("0000"==a.errCode){var r=n.data,i=n.total;e.dataSource=r,e.pageData.total=Number(i),e.$emit("emit-dt-length",e.dataSource.length)}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.pageData.loading=!1}))},fnFastSubtender:function(){var e=this,t=Object.assign({},this.projectData);Object(s["i"])(t).then((function(t){var a=t.data;"0000"==a.errCode?(e.$emit("update-product-info"),e.fnGetData()):e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},fnHandleAdd:function(){var e=this;Object(s["a"])(this.projectData).then((function(t){var a=t.data||{};"0000"==a.errCode?(e.$emit("update-product-info"),e.fnGetData()):e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},fnDeleteDivideTender:function(e,t){var a=this;if(2==e&&0==this.deleteTitleType)return this.$message.warning("请选择要删除的数据！"),!1;if(2!=e){var n=1==e?this.selectedRowKeys.join(","):t;Object(s["o"])(n).then((function(e){var t=e.data||{};"0000"==t.errCode?(a.$emit("update-product-info"),a.$message.success(t.responseResult,3),a.fnClearCheckdData(),a.fnGetData()):a.$error({title:"错误提示",content:a.BASE.handleErrorMsg(t)})}))}},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(e){if(!e){var a=Object.assign({},t.projectData);a.cntractingList=t.dataSource,Object(s["tb"])(t.dataSource).then((function(e){var a=e.data||{};"0000"==a.errCode?(t.$emit("update-product-info"),t.$message.success(a.responseResult,3),t.fnGetData()):t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))}}))},fnFocus:function(e,t){this.curRecord=t},fnHandleChange:function(e,t,a){var n=Object(i["a"])(this.dataSource),r=n.filter((function(e){return t===e.subtenderId}))[0];r&&(r[a]=e,this.dataSource=n)},fnCheckName:function(e,t,a){var n=this;if(this.BASE.CheckIsNullOrEmpty(t))if(t.length>10)a("长度限制为10个字符");else{var r=!1;if(this.dataSource.every((function(e){return!n.curRecord.subtenderId||n.curRecord.subtenderId==e.subtenderId||t!=e.subtenderName||(r=!0,!1)})),t&&r)return this.curRecord={},void a("与其它标名重复");this.curRecord={},a()}else a("请输入标名")},fnClearCheckdData:function(){this.selectedRowKeys=[],this.selectedRows=[]},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},sizeChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.fnGetData()},pageChange:function(e,t){this.pageData.page=e,this.pageData.limit=t,this.fnGetData()}}},u=d,l=(a("66b4"),a("2877")),f=Object(l["a"])(u,n,r,!1,null,"94276bde",null);t["default"]=f.exports},a623:function(e,t,a){"use strict";var n=a("23e7"),r=a("b727").every,i=a("a640"),o=a("ae40"),c=i("every"),s=o("every");n({target:"Array",proto:!0,forced:!c||!s},{every:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);