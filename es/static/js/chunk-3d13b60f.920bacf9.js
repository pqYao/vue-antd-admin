(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d13b60f","chunk-2d0aeadc","chunk-1ba20d2e","chunk-2d0d0642"],{"0aa6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-info-des-wrapper"},[a("a-card",[a("Heading",{attrs:{name:"项目信息"}}),a("Descriptions",{attrs:{list:t.labelList,param:t.projectData,jumpData:t.jumpData}})],1)],1)},i=[],r=(a("99af"),a("d3b7"),{name:"project-info-des",props:{projectData:{type:Object,default:function(){return{}}},url:{type:String,default:""},purchaseTypeKey:{type:String,default:"purchaseType"}},components:{Heading:function(){return a.e("chunk-e2119ce0").then(a.bind(null,"8ab7"))},Descriptions:function(){return a.e("chunk-645cdc36").then(a.bind(null,"57e4"))}},data:function(){return{jumpData:{},labelList:[{label:"项目编号",key:"projectCode",show:!0,jump:!0},{label:"项目名称",key:"projectName",show:!0},{label:"采购方式",key:"purchaseType",show:!0,pt:!0},{label:"是否委托",key:"entrustFlag",flag:!0,show:!0},{label:"是否资格预审",key:"prequalficationFlag",flag:!0,show:!0}]}},created:function(){this.fnInit()},watch:{projectData:function(){this.fnInit()},purchaseTypeKey:function(){this.fnInit()}},methods:{fnInit:function(){this.jumpData={projectCode:{url:"".concat(this.url,"/").concat(this.projectData.projectId)}},this.labelList[2].key=this.purchaseTypeKey}}}),o=r,s=a("2877"),c=Object(s["a"])(o,n,i,!1,null,null,null);e["default"]=c.exports},"3eb5":function(t,e,a){"use strict";var n=a("adf3"),i=a.n(n);i.a},5913:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"wrapper",staticClass:"anchor-demo-custom",on:{mouseover:t.mouseOver,mouseleave:t.mouseLeave}},[t.isShow?a("div",{staticClass:"anchor-btn"},[a("a-icon",{attrs:{type:"right"}}),a("a-icon",{staticStyle:{"margin-left":"-4px"},attrs:{type:"right"}})],1):a("div",{staticClass:"anchor-btn"},[a("a-icon",{attrs:{type:"left"}}),a("a-icon",{staticStyle:{"margin-left":"-4px"},attrs:{type:"left"}})],1),a("a-anchor",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],ref:"demo",attrs:{targetOffset:200},on:{click:t.handleClickFun,change:t.onChange}},[t._l(t.anchorList,(function(e,n){return a("span",{key:n},[a("a-anchor-link",{ref:"span",refInFor:!0,attrs:{href:"#"+e}},[a("template",{slot:"title"},[a("i",{class:["iconfont","icon-yuanxing"]}),t._v(" "+t._s(e)+" ")])],2)],1)})),a("div")],2)],1)},i=[],r={props:{anchorList:{type:Array,required:!1}},data:function(){return{isShow:!1}},methods:{handleClickFun:function(t,e){if(t.preventDefault(),e.href){var a=document.getElementById(e.href);a&&a.scrollIntoView({block:"start",behavior:"smooth"})}},mouseOver:function(){var t=this;this.$refs.wrapper.style.marginTop=-(33*this.anchorList.length+40)/2+"px",this.$nextTick((function(){t.isShow=!0}))},mouseLeave:function(){this.isShow=!1},onChange:function(){}}},o=r,s=(a("3eb5"),a("2877")),c=Object(s["a"])(o,n,i,!1,null,"22bac0c2",null);e["default"]=c.exports},"687a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"inline-block",marginLeft:"8px"}},[a("a-popconfirm",{attrs:{title:t.title},on:{confirm:t.fnConfirm}},[a("a-popover",{attrs:{placement:"bottom",content:t.hoverContent},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-button",{attrs:{type:"primary"},on:{click:t.fnClick}},[t._v(" "+t._s(t.btnName)+" ")])],1)],1)],1)},i=[],r={name:"pop-confirm-btn",props:{title:{type:String,default:""},hoverContent:{type:String,default:""},btnName:{type:String,default:""}},data:function(){return{visible:!1}},methods:{fnConfirm:function(){this.$emit("confirm-action")},fnClick:function(){this.visible=!1}}},o=r,s=a("2877"),c=Object(s["a"])(o,n,i,!1,null,null,null);e["default"]=c.exports},"6cea":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-card",[a("Heading",{attrs:{name:"产品明细"}},[this.isDetail||0==t.subcontractDataLength?t._e():[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleAdd("product")}}},[t._v(" 关联产品 ")]),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:t.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),t._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary",disabled:t.isConnect},on:{click:t.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),t._v(" 保存 ")])]],2),a("a-table",{staticClass:"es-table",attrs:{size:"small",bordered:!0,loading:t.pageData.loading,pagination:!1,columns:t.columns,dataSource:t.dataSource,rowKey:"scontractingDetailId",rowSelection:t.isDetail?null:{fixed:!0,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},scroll:{x:!0}},scopedSlots:t._u([{key:"amount",fn:function(e,n,i){return[t.isDetail?a("span",[t._v(t._s(e))]):a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:t.checkAmount}],initialValue:e}],expression:"[\n                `amount${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: checkAmount }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{change:function(e){return t.onCellChange(e.target.value,n.scontractingDetailId,"amount")}}})],1)],1)]}},{key:"action",fn:function(e){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return t.deleteById(e.scontractingDetailId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[t._v("删除")])])]}}])}),this.isDetail?a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:t.pageData.page,pageSize:t.pageData.limit,total:t.pageData.total},on:{change:t.sizeChange,showSizeChange:t.pageChange}}):t._e()],1),t.productVisible?a("a-modal",{attrs:{title:"选择产品",width:"80%",centered:!0,maskClosable:!1},on:{ok:function(e){return t.handleOk("product")}},model:{value:t.productVisible,callback:function(e){t.productVisible=e},expression:"productVisible"}},[a("ProductSelect",{ref:"product"})],1):t._e()],1)},i=[],r=(a("4de4"),a("a15b"),a("a9e3"),a("2909")),o=a("8ab7"),s=a("7775"),c=a("325f"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-row",{attrs:{type:"flex"}},[a("a-col",{attrs:{flex:1}},[a("a-card",[a("Heading",{attrs:{name:"层级"}}),t.treeData.length>0?a("a-tree",{attrs:{"show-line":"","tree-data":this.treeData,defaultExpandedKeys:t.defaultExpandedKeys,defaultSelectedKeys:t.selectedKeys},on:{select:t.onSelect}}):t._e()],1)],1),a("a-col",{attrs:{flex:4}},[a("div",[a("SearchForm",{ref:"SearchForm",attrs:{searchList:t.searchList,name:"查询条件"},on:{"on-filter":t.toSearch}}),a("a-card",[a("a-table",{attrs:{size:"small",loading:t.pageData.loading,pagination:!1,columns:t.columns,dataSource:t.dataSource,rowSelection:{fixed:!0,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},scroll:{x:!0},rowKey:"businessKey"},scopedSlots:t._u([{key:"projectCode",fn:function(e){return a("a",{},[t._v(t._s(e))])}}])}),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:t.pageData.page,pageSize:t.pageData.limit,total:t.pageData.total},on:{change:t.sizeChange,showSizeChange:t.pageChange}})],1)],1)])],1)},u=[],d=(a("4160"),a("159b"),a("5530")),h=a("5880"),p=a("5acc"),f={limit:15,total:0,page:1,loading:!1},g=[{title:"序号",dataIndex:"number",align:"center",customRender:function(t,e,a){return"".concat((f.page-1)*f.limit+a+1)},width:100},{title:"产品编码",dataIndex:"productCode"},{title:"产品名称",dataIndex:"productName"},{title:"产品单位",dataIndex:"measure"},{title:"总数量",dataIndex:"totalAmount"}],m=[],b=[{type:"input",label:"产品名称",key:"productName"},{type:"input",label:"产品编码",key:"productCode"}],v={name:"sub-contract-product-select",components:{SearchForm:p["a"],Pagination:c["default"],Heading:o["default"]},data:function(){return{treeData:[],selectedKeys:[],columns:g,dataSource:m,searchList:b,defaultExpandedKeys:[],selectedRowKeys:[],selectedRows:[],filter:{},pageData:{limit:15,total:0,page:1,loading:!1},projectId:this.$route.params.id}},computed:Object(d["a"])({},Object(h["mapGetters"])("account",["dictionary"])),watch:{treeData:{handler:function(t){return t},immediate:!0,deep:!0}},created:function(){this.init()},methods:{init:function(){this.getData(),this.findTree(),this.findIds()},toSearch:function(t){this.pageData.page=1,this.filter=t,this.getData()},findTree:function(){var t=this;Object(s["j"])({projectId:this.projectId}).then((function(e){var a=e.data;if("0000"==a.errCode){var n=a.responseResult;t.treeData.push(n),t.treeData.forEach((function(e){e.children.length>0&&!e.selectable&&e.children.forEach((function(e){t.recursive(e)}))}))}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))},recursive:function(t){var e=this;t.selectable?this.defaultExpandedKeys.length>0||(this.defaultExpandedKeys=["".concat(t.key)],this.selectedKeys=["".concat(t.key)],this.getData()):t.children.forEach((function(t){e.recursive(t)}))},findIds:function(){var t=this;Object(s["h"])(this.projectId).then((function(e){var a=e.data;if("0000"==a.errCode){var n=a.responseResult;t.selectedRowKeys=n}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))},onSelect:function(t){this.$refs.SearchForm.handleReset(),this.filter={},this.selectedKeys=t,this.pageData.page=1,this.getData()},getData:function(){var t=this,e=Object.assign({limit:this.pageData.limit,page:this.pageData.page,subcontractingId:this.selectedKeys[0]||"",projectId:this.projectId},this.filter);this.pageData.loading=!0,Object(s["i"])(e).then((function(e){var a=e.data,n=e.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;t.dataSource=i,t.pageData.total=Number(r)}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)});t.pageData.loading=!1}))},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},sizeChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},pageChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},getRes:function(){return this.selectedRowKeys}}},y=v,D=a("2877"),S=Object(D["a"])(y,l,u,!1,null,null,null),w=S.exports,C={limit:15,total:0,page:1,loading:!1},x=[{title:"序号",dataIndex:"number",align:"center",width:80,customRender:function(t,e,a){return"".concat((C.page-1)*C.limit+a+1)}},{title:"标名",dataIndex:"subtenderName",align:"center"},{title:"包名",dataIndex:"subcontractingName",align:"center"},{title:"产品编码",dataIndex:"productCode",align:"center"},{title:"产品名称",dataIndex:"productName",align:"center"},{title:"单位",dataIndex:"measure",align:"center"},{title:"总数量",dataIndex:"totalAmount",align:"center"},{title:"需求数量",dataIndex:"amount",scopedSlots:{customRender:"amount"},align:"center"},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],I=[],j={name:"sub-contract-product",components:{Heading:o["default"],Pagination:c["default"],ProductSelect:w},props:{isDetail:{type:Boolean,default:!1},subcontractDataLength:{type:Number}},data:function(){return{form:this.$form.createForm(this),columns:x,dataSource:I,selectedRowKeys:[],selectedRows:[],projectId:this.$route.params.id,isConnect:!1,productVisible:!1,pageData:C}},watch:{isDetail:{handler:function(t){if(t){var e=Object(r["a"])(this.columns);delete e[8],this.columns=e}return t},immediate:!0,deep:!0}},computed:{hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}},created:function(){this.getData()},methods:{getData:function(){var t=this,e=Object.assign({limit:this.isDetail?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectId},this.filter);this.dataSource=[],this.pageData.loading=!0,Object(s["D"])(e).then((function(e){var a=e.data,n=e.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;t.dataSource=i,t.pageData.total=Number(r)}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)});t.pageData.loading=!1}))},handleAdd:function(t){this["".concat(t,"Visible")]=!0},handleOk:function(t){var e=this,a=this.$refs[t].getRes();Object(s["O"])(this.projectId,a.join(",")).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.success(n,3),e.getData()}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})})),this["".concat(t,"Visible")]=!1},checkAmount:function(t,e,a){if(this.BASE.CheckIsNullOrEmpty(e)){var n=this.BASE.reg.mountReg;n.test(e)||a("请输入0.01-999999999999.99的数值！"),a()}else a("请输入需求数量")},onCellChange:function(t,e,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(t){return e===t.scontractingDetailId}))[0];i&&(i[a]=t,this.dataSource=n)},handleSubmit:function(t){var e=this;t.preventDefault(t),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(t){t||(e.isConnect=!0,e.updateInfo())}))},updateInfo:function(){var t=this;Object(s["bb"])(this.dataSource).then((function(e){var a=e.data;"0000"===a.errCode?(t.$message.success(a.responseResult,3),t.getData()):t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)}),t.isConnect=!1}))},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},handleDelete:function(t){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=t&&this.deleteById()},deleteById:function(t){var e=this,a=t||this.selectedRowKeys.join(",");Object(s["p"])(a).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.warning(n),e.selectedRowKeys=[],e.getData()}}))},sizeChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},pageChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()}}},R=j,k=Object(D["a"])(R,n,i,!1,null,null,null);e["a"]=k.exports},adf3:function(t,e,a){},d9da:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("project-info",{attrs:{id:"项目信息",url:"/compare/prepare/detail",purchaseTypeKey:"comparatePurchaseType",projectData:t.formData}})],1)},i=[],r=a("0aa6"),o=a("7775"),s={name:"sub-contract-project",components:{ProjectInfo:r["default"]},data:function(){return{formData:{}}},created:function(){this.findInfo()},methods:{findInfo:function(){var t=this;Object(o["F"])(this.$route.params.id).then((function(e){var a=e.data;if("0000"==a.errCode){var n=a.responseResult;t.formData=n}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))}}},c=s,l=a("2877"),u=Object(l["a"])(c,n,i,!1,null,null,null);e["a"]=u.exports},f48e:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-card",[a("Heading",{attrs:{name:"分包明细"}},[t.isDetail?t._e():[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleAdd("product")}}},[t._v(" 分包 ")]),a("pop-confirm-btn",{attrs:{title:"是否快捷分包?",hoverContent:"在每个标下分1个包，并自动关联每个标下的所有产品",btnName:"快捷分包"},on:{"confirm-action":t.addFast}}),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:t.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),t._v(" 批量删除 ")])],1),a("a-button",{attrs:{type:"primary",disabled:t.isConnect},on:{click:t.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),t._v(" 保存 ")])]],2),a("a-table",{staticClass:"es-table",attrs:{size:"small",bordered:!0,loading:t.pageData.loading,pagination:!1,columns:t.columns,dataSource:t.dataSource,rowKey:"subcontractingId",rowSelection:t.isDetail?null:{fixed:!0,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},scroll:{x:!0}},scopedSlots:t._u([{key:"subcontractingName",fn:function(e,n,i){return[t.isDetail?a("span",[t._v(t._s(e))]):a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["subcontractingName"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:t.checkSubContract}],initialValue:e}],expression:"[\n                `subcontractingName${index}`,\n                {\n                  validateTrigger: ['blur'],\n                  rules: [{ required: true, validator: checkSubContract }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{focus:function(e){return t.fnFocus(e,n)},change:function(e){return t.onCellChange(e.target.value,n.subcontractingId,"subcontractingName")}}})],1)],1)]}},{key:"bondMoney",fn:function(e,n,i){return[t.isDetail?a("span",[t._v(t._s(e))]):a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["bondMoney"+i,{rules:[{required:!0,validator:t.validMoney}],initialValue:e}],expression:"[\n                `bondMoney${index}`,\n                {\n                  rules: [{ required: true, validator: validMoney }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{disabled:!n.subcontractingName,allowClear:""},on:{change:function(e){return t.onCellChange(e.target.value,n.subcontractingId,"bondMoney")}}})],1)],1)]}},{key:"reckonMoney",fn:function(e,n,i){return[t.isDetail?a("span",[t._v(t._s(e))]):a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["reckonMoney"+i,{rules:[{required:!0,validator:t.validMoney}],initialValue:e}],expression:"[\n                `reckonMoney${index}`,\n                {\n                  rules: [{ required: true, validator: validMoney }],\n                  initialValue: text\n                }\n              ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{change:function(e){return t.onCellChange(e.target.value,n.subcontractingId,"reckonMoney")}}})],1)],1)]}},{key:"action",fn:function(e){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return t.deleteById(e.subcontractingId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[t._v("删除")])])]}}])}),this.isDetail?a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:t.pageData.page,pageSize:t.pageData.limit,total:t.pageData.total},on:{change:t.sizeChange,showSizeChange:t.pageChange}}):t._e()],1),t.productVisible?a("a-modal",{attrs:{title:"分包",width:"80%",centered:!0,maskClosable:!1},on:{ok:function(e){return t.handleOk("product")}},model:{value:t.productVisible,callback:function(e){t.productVisible=e},expression:"productVisible"}},[a("ProductSelect",{ref:"product",attrs:{projectId:this.projectId},on:{getData:t.getData}})],1):t._e()],1)},i=[],r=(a("4de4"),a("4160"),a("a15b"),a("a9e3"),a("159b"),a("2909")),o=a("8ab7"),s=a("687a"),c=a("7775"),l=a("325f"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-row",{attrs:{type:"flex"}},[a("a-col",{attrs:{flex:1}},[a("a-card",[a("Heading",{attrs:{name:"层级"}}),t.treeData.length>0?a("a-tree",{attrs:{"show-line":"","tree-data":this.treeData,defaultExpandAll:t.autoExpandParent,defaultSelectedKeys:t.selectedKeys},on:{select:t.onSelect}}):t._e()],1)],1),a("a-col",{attrs:{flex:4}},[a("div",[a("a-card",[a("Heading",{attrs:{name:"查询结果"}},[a("a-button",{attrs:{type:"primary",disabled:t.isConnect},on:{click:t.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),t._v(" 保存 ")]),a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleAdd()}}},[a("i",{class:["iconfont","icon-xinzeng"]}),t._v(" 新增 ")]),a("a-popconfirm",{attrs:{disabled:!this.hasSelectedRowKeys,title:"确定批量删除?","ok-text":"确认","cancel-text":"取消"},on:{confirm:t.handleDelete}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleDelete(0)}}},[a("i",{class:["iconfont","icon-weibiaoti544"]}),t._v(" 批量删除 ")])],1)],1),a("a-table",{staticClass:"es-table",attrs:{size:"small",loading:t.pageData.loading,pagination:!1,columns:t.columns,dataSource:t.dataSource,rowSelection:{fixed:!0,selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},scroll:{x:!0},rowKey:"subcontractingId"},scopedSlots:t._u([{key:"subcontractingName",fn:function(e,n,i){return[a("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["subcontractingName"+i,{validateTrigger:["blur"],rules:[{required:!0,validator:t.checkSubContract}],initialValue:e}],expression:"[\n                    `subcontractingName${index}`,\n                    {\n                      validateTrigger: ['blur'],\n                      rules: [\n                        { required: true, validator: checkSubContract }\n                      ],\n                      initialValue: text\n                    }\n                  ]"}],staticStyle:{margin:"-5px 0",width:"100%"},attrs:{allowClear:""},on:{focus:function(e){return t.fnFocus(e,n)},change:function(e){return t.onCellChange(e.target.value,n.subcontractingId,"subcontractingName")}}})],1)],1)]}},{key:"action",fn:function(e){return[a("a-popconfirm",{attrs:{title:"是否确认删除所选行?","ok-text":"确认","cancel-text":"取消"},on:{confirm:function(a){return t.deleteById(e.subcontractingId)}}},[a("a",{staticStyle:{"margin-right":"8px"}},[t._v("删除")])])]}}])}),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.pageData.total>0,expression:"pageData.total > 0"}],attrs:{value:t.pageData.page,pageSize:t.pageData.limit,total:t.pageData.total},on:{change:t.sizeChange,showSizeChange:t.pageChange}})],1)],1)])],1)},d=[],h=a("5530"),p=a("5880"),f={limit:15,total:0,page:1,loading:!1},g=[{title:"序号",dataIndex:"number",align:"center",customRender:function(t,e,a){return"".concat((f.page-1)*f.limit+a+1)},width:100},{title:"包名",dataIndex:"subcontractingName",scopedSlots:{customRender:"subcontractingName"}},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],m=[],b={name:"sub-contract-select",components:{Pagination:l["default"],Heading:o["default"]},props:{projectId:{type:String,default:""}},data:function(){return{form:this.$form.createForm(this),treeData:[],selectedKeys:[],columns:g,dataSource:m,selectedRowKeys:[],selectedRows:[],autoExpandParent:!0,isConnect:!1,curRecord:{},pageData:{limit:15,total:0,page:1,loading:!1}}},computed:Object(h["a"])(Object(h["a"])({},Object(p["mapGetters"])("account",["dictionary"])),{},{hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}}),watch:{treeData:{handler:function(t){return t},immediate:!0,deep:!0}},created:function(){this.init()},methods:{init:function(){this.getData(),this.findTree()},findTree:function(){var t=this;Object(c["k"])(this.projectId).then((function(e){var a=e.data;if("0000"==a.errCode){var n=a.responseResult;t.treeData.push(n),t.treeData.forEach((function(e){if(e.children.length>0){if(!e.selectable)return void e.children.forEach((function(e){t.recursive(e)}));t.selectedKeys=["".concat(e.key)],t.getData()}}))}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))},recursive:function(t){var e=this;if(t.selectable)this.selectedKeys.length>0||(this.selectedKeys=["".concat(t.key)],this.getData());else{if(null==t.children)return;t.children.forEach((function(t){e.recursive(t)}))}},onSelect:function(t){this.selectedKeys=t,this.pageData.page=1,this.getData()},getData:function(){var t=this,e=Object.assign({limit:this.pageData.limit,page:this.pageData.page,subtenderId:this.selectedKeys[0]||"",projectId:this.projectId||""});this.dataSource=[],this.pageData.loading=!0,Object(c["C"])(e).then((function(e){var a=e.data,n=e.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;t.dataSource=i,t.pageData.total=Number(r),t.$emit("getData")}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)});t.pageData.loading=!1}))},fnFocus:function(t,e){this.curRecord=e},checkSubContract:function(t,e,a){var n=this;if(this.BASE.CheckIsNullOrEmpty(e)){var i="";this.BASE.ObjectIsNull(this.curRecord)?a():(this.dataSource.forEach((function(t){n.curRecord.subcontractingId&&n.curRecord.subcontractingId==t.subcontractingId&&(i=t.subcontractingId)})),Object(c["gb"])(this.projectId,this.selectedKeys[0],i,e).then((function(t){var e=t.data,n="";"0000"!==e.errCode?(n=e.customMess,a(n)):a()})),this.curRecord={})}else a("请输入包名")},onCellChange:function(t,e,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(t){return e===t.subcontractingId}))[0];i&&(i[a]=t,this.dataSource=n)},handleAdd:function(){var t=this;this.selectedKeys?Object(c["f"])(this.projectId,this.selectedKeys.join(",")).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.success(n,3),t.getData()}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})})):this.$message.warning("请先在左侧选中标！")},handleDelete:function(t){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=t&&this.deleteById()},deleteById:function(t){var e=this,a=t||this.selectedRowKeys.join(",");Object(c["o"])(a).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.warning(n),e.selectedRowKeys=[],e.getData()}}))},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},sizeChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},pageChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},getRes:function(){return this.selectedRowKeys},handleSubmit:function(t){var e=this;t.preventDefault(t),this.form.validateFields((function(t){t||(e.isConnect=!0,e.updateInfo())}))},updateInfo:function(){var t=this;Object(c["ab"])(this.dataSource).then((function(e){var a=e.data;"0000"===a.errCode?(t.$message.success(a.responseResult,3),t.getData()):t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)}),t.isConnect=!1}))}}},v=b,y=a("2877"),D=Object(y["a"])(v,u,d,!1,null,null,null),S=D.exports,w={limit:15,total:0,page:1,loading:!1},C=[{title:"序号",dataIndex:"number",align:"center",width:80,customRender:function(t,e,a){return"".concat((w.page-1)*w.limit+a+1)}},{title:"标名",dataIndex:"subTenderName",align:"center"},{title:"包名",dataIndex:"subcontractingName",scopedSlots:{customRender:"subcontractingName"},align:"center"},{title:"估算含税金额（元)",dataIndex:"reckonMoney",scopedSlots:{customRender:"reckonMoney"},align:"center"},{title:"操作",align:"center",scopedSlots:{customRender:"action"},fixed:"right",width:80}],x=[],I={name:"sub-contract-table",components:{Heading:o["default"],Pagination:l["default"],ProductSelect:S,PopConfirmBtn:s["default"]},props:{isDetail:{type:Boolean,default:!1}},data:function(){return{form:this.$form.createForm(this),columns:C,dataSource:x,projectId:this.$route.params.id,selectedRowKeys:[],selectedRows:[],curRecord:{},isConnect:!1,productVisible:!1,pageData:w}},watch:{isDetail:{handler:function(t){if(t){var e=Object(r["a"])(this.columns);delete e[4],this.columns=e}return t},immediate:!0,deep:!0}},computed:{hasSelectedRowKeys:function(){return 0!=!!this.selectedRowKeys.length}},mounted:function(){this.getData()},methods:{getData:function(){var t=this,e=Object.assign({limit:this.isDetail?this.pageData.limit:1e4,page:this.pageData.page,projectId:this.projectId},this.filter);this.dataSource=[],this.pageData.loading=!0,Object(c["C"])(e).then((function(e){var a=e.data,n=e.data.responseResult;if("0000"==a.errCode){var i=n.data,r=n.total;t.dataSource=i,t.$emit("emit-sc-length",t.dataSource.length),t.$emit("update-product-info"),t.pageData.total=Number(r)}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)});t.pageData.loading=!1}))},handleAdd:function(t){this["".concat(t,"Visible")]=!0},handleOk:function(t){this.getData(),this["".concat(t,"Visible")]=!1},addFast:function(){var t=this;Object(c["e"])(this.projectId).then((function(e){var a=e.data;if("0000"===a.errCode){var n=a.responseResult;t.$message.success(n,3),t.getData()}else t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)})}))},validMoney:function(t,e,a){var n=this.BASE.reg.moneyReg;this.BASE.CheckIsNullOrEmpty(e)?(n.test(e)||a("请输入正确的金额"),a()):a("请输入金额")},fnFocus:function(t,e){this.curRecord=e},checkSubContract:function(t,e,a){var n=this;if(this.BASE.CheckIsNullOrEmpty(e))if(this.BASE.ObjectIsNull(this.curRecord))a();else{var i="",r="";this.dataSource.forEach((function(t){n.curRecord.subcontractingId&&n.curRecord.subcontractingId==t.subcontractingId&&(r=t.subtenderId,i=t.subcontractingId)})),Object(c["gb"])(this.projectId,r,i,e).then((function(t){var e=t.data,n="";"0000"!==e.errCode?(n=e.customMess,a(n)):a()})),this.curRecord={}}else a("请输入包名")},onCellChange:function(t,e,a){var n=Object(r["a"])(this.dataSource),i=n.filter((function(t){return e===t.subcontractingId}))[0];i&&(i[a]=t,this.dataSource=n)},handleSubmit:function(t){var e=this;t.preventDefault(t),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(t){t||(e.isConnect=!0,e.updateInfo())}))},updateInfo:function(){var t=this;Object(c["ab"])(this.dataSource).then((function(e){var a=e.data;"0000"===a.errCode?(t.$message.success(a.responseResult,3),t.getData()):t.$error({title:"错误提示",content:t.BASE.handleErrorMsg(a)}),t.isConnect=!1}))},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectedRows=e},handleDelete:function(t){if(!this.hasSelectedRowKeys)return this.$message.warning("请选择要删除的数据！"),!1;0!=t&&this.deleteById()},deleteById:function(t){var e=this,a=t||this.selectedRowKeys.join(",");Object(c["o"])(a).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.success(n),e.selectedRowKeys=[],e.getData()}}))},sizeChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()},pageChange:function(t,e){this.pageData.page=t,this.pageData.limit=e,this.getData()}}},j=I,R=Object(y["a"])(j,n,i,!1,null,null,null);e["a"]=R.exports}}]);