(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22ce92"],{f4f4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("Heading",{attrs:{name:e.noticeName}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleClick("case")}}},[e._v(" 选择公告模板 ")]),a("a-button",{attrs:{type:"primary"},on:{click:e.handlePreview}},[a("i",{class:["iconfont","icon-yulancopy"]}),e._v(" 预览 ")]),a("a-button",{attrs:{type:"primary",disabled:e.isConnect},on:{click:e.handleSubmit}},[a("i",{class:["iconfont","icon-baocun"]}),e._v(" 保存 ")])],1),a("a-form",{staticClass:"es-form es-form-bk",attrs:{layout:"horizontal",form:e.form},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.handleSubmit(t))}}},[a("a-row",[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",e._b({attrs:{label:"公告发布媒介"}},"a-form-item",e.BASE.threeItemLayout,!1),[a("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["pushSystem",{initialValue:e.pushSystem,rules:[{required:!0,message:"请选择公告发布媒介"}]}],expression:"[\n              'pushSystem',\n              {\n                initialValue: pushSystem,\n                rules: [{ required: true, message: '请选择公告发布媒介' }]\n              }\n            ]"}],staticStyle:{width:"100%"},on:{change:e.onChange}},[a("a-row",e._l(e.dictionary.pushSystem,(function(t,n){return a("a-col",{key:n,class:{"hide-select-item":!t},attrs:{span:8}},[a("a-checkbox",{attrs:{value:""+n}},[e._v(e._s(t))])],1)})),1)],1)],1)],1)],1),a("a-row",[a("a-col",{attrs:{md:16,sm:24}},[a("a-form-item",e._b({attrs:{label:"公告标题"}},"a-form-item",e.BASE.twoItemLayout,!1),[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["noticeTitle",{maxLength:50,initialValue:e.formData.noticeTitle,validateTrigger:["blur"],rules:[{required:!0,message:"请输入公告标题"}]}],expression:"[\n              `noticeTitle`,\n              {\n                maxLength: 50,\n                initialValue: formData.noticeTitle,\n                validateTrigger: ['blur'],\n                rules: [{ required: true, message: '请输入公告标题' }]\n              }\n            ]"}],attrs:{placeholder:"请输入",allowClear:""}})],1)],1)],1),a("a-row",[a("a-col",{attrs:{md:24,sm:24}},[a("a-form-item",e._b({attrs:{label:"公告内容"}},"a-form-item",e.BASE.threeItemLayout,!1),[e.tinymceRefresh?a("tinymce",{attrs:{height:300},model:{value:e.formData.noticeContext,callback:function(t){e.$set(e.formData,"noticeContext",t)},expression:"formData.noticeContext"}}):e._e()],1)],1)],1)],1),e.caseVisible?a("a-modal",{attrs:{title:"选择模板",width:"70%",centered:!0,maskClosable:!1},on:{ok:function(t){return e.handleOk("case")}},model:{value:e.caseVisible,callback:function(t){e.caseVisible=t},expression:"caseVisible"}},[a("notice-case",{ref:"case",attrs:{purchaseType:this.purchaseType,templateType:"1"}})],1):e._e()],1)},r=[],i=(a("a15b"),a("ac1f"),a("1276"),a("5530")),o=a("5880"),s=a("8ab7"),c=a("8256"),l=a("d15c"),u=a("7775"),d={name:"tender-notice",components:{Tinymce:c["default"],Heading:s["default"],NoticeCase:l["a"]},props:{noticeName:{type:[String],default:""}},data:function(){return{form:this.$form.createForm(this),formData:{},isConnect:!1,tenderNoticeId:"",pushSystem:[],tinymceRefresh:!0,caseVisible:!1}},computed:Object(i["a"])(Object(i["a"])({},Object(o["mapGetters"])("account",["dictionary"])),{},{tenderVindicateId:function(){return this.$route.params.id},projectId:function(){return this.$route.query.projectId},purchaseType:function(){return this.$route.query.purchaseType}}),watch:{pushSystem:{handler:function(e){return e},immediate:!0,deep:!0},formData:{handler:function(e){return e},immediate:!0,deep:!0}},created:function(){this.handleGetData()},activated:function(){this.handleGetData()},methods:{handlePreview:function(){this.$router.push({path:"/notice-preview/".concat(this.formData.tenderVindicateId),query:{formData:JSON.stringify(this.formData)}})},onChange:function(e){this.formData.pushSystem=e.join(",")},handleClick:function(e){this["".concat(e,"Visible")]=!0},handleOk:function(e){if("case"==e){var t=this.$refs[e].getRes();if(!t)return void this.$message.warning("请选择模板！");this.formData.noticeContext="",this.formData.noticeContext=t.content}this["".concat(e,"Visible")]=!1},handleGetData:function(){var e=this;Object(u["z"])(this.tenderVindicateId,1).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.formData=n||{},e.pushSystem=e.formData?e.formData.pushSystem.split(","):"",e.tinymceRefresh=!1,e.$nextTick((function(){e.tinymceRefresh=!0}))}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)})}))},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFieldsAndScroll(this.BASE.formScrollOptions,(function(e,a){if(!e){for(var n in a)"pushSystem"!=n&&(t.formData[n]=a[n]);t.isConnect=!0,t.formData.tenderVindicateId=t.tenderVindicateId,t.formData.projectId=t.projectId,t.formData.noticeType=1,t.formData.tenderNoticeId?t.handleUpdate():t.handleAdd()}}))},handleAdd:function(){var e=this;Object(u["c"])(this.formData).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.formData=n||{},e.$message.success("保存成功"),e.handleGetData()}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.isConnect=!1}))},handleUpdate:function(){var e=this;Object(u["Y"])(this.formData).then((function(t){var a=t.data;if("0000"===a.errCode){var n=a.responseResult;e.$message.success(n),e.handleGetData()}else e.$error({title:"错误提示",content:e.BASE.handleErrorMsg(a)});e.isConnect=!1}))}}},m=d,f=a("2877"),h=Object(f["a"])(m,n,r,!1,null,null,null);t["default"]=h.exports}}]);